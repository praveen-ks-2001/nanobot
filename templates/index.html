<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nanobot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            gray: {
              750: '#2d3748',
              850: '#1a202c',
              900: '#111827',
              950: '#030712', // Darker black
            }
          }
        }
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    [x-cloak] {
      display: none !important;
    }

    .log-viewer {
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
    }

    .log-viewer::-webkit-scrollbar {
      width: 6px;
    }

    .log-viewer::-webkit-scrollbar-thumb {
      border-radius: 3px;
      background: #374151;
    }

    .log-viewer::-webkit-scrollbar-track {
      background: transparent;
    }
  </style>
</head>

<body class="bg-black text-white h-screen flex overflow-hidden antialiased selection:bg-emerald-500/30" x-data="app()"
  x-init="init()" x-cloak>

  <!-- Sidebar -->
  <aside class="w-64 flex flex-col border-r border-gray-800 bg-black flex-shrink-0">
    <!-- Header -->
    <div class="p-6 flex items-center gap-3">
      <div
        class="w-8 h-8 bg-white text-black rounded-lg flex items-center justify-center font-bold text-sm tracking-tighter">
        NB</div>
      <div>
        <h1 class="font-semibold text-sm leading-tight">Nanobot</h1>
        <div class="flex items-center gap-1.5 mt-0.5">
          <div class="w-1.5 h-1.5 rounded-full"
            :class="status.gateway?.state === 'running' ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]' : 'bg-red-500'">
          </div>
          <span class="text-[10px] uppercase tracking-wider font-medium text-gray-500"
            x-text="status.gateway?.state || 'STOPPED'"></span>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-3 space-y-8 overflow-y-auto py-4">
      <!-- Setup Group -->
      <div>
        <h3 class="px-3 text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">Setup Workflow</h3>
        <div class="space-y-0.5">
          <button @click="tab = 'overview'"
            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
            :class="tab === 'overview' ? 'text-white' : 'text-gray-500 hover:text-gray-300'">
            <div class="w-4 h-4 rounded-full border-2 transition-colors flex items-center justify-center"
              :class="tab === 'overview' ? 'border-white' : 'border-gray-600'">
              <div class="w-1.5 h-1.5 rounded-full bg-white" x-show="tab === 'overview'"></div>
            </div>
            Overview
          </button>

          <button @click="tab = 'providers'"
            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 relative group"
            :class="tab === 'providers' ? 'text-white' : 'text-gray-500 hover:text-gray-300'">
            <div class="w-4 h-4 rounded-full border-2 flex items-center justify-center transition-colors"
              :class="tab === 'providers' ? 'border-white' : (activeProviderCount > 0 ? 'border-emerald-500/50' : 'border-gray-600')">
              <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"
                x-show="activeProviderCount > 0 && tab !== 'providers'"></div>
              <div class="w-1.5 h-1.5 rounded-full bg-white" x-show="tab === 'providers'"></div>
            </div>
            AI Providers
          </button>

          <button @click="tab = 'channels'"
            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
            :class="tab === 'channels' ? 'text-white' : 'text-gray-500 hover:text-gray-300'">
            <div class="w-4 h-4 rounded-full border-2 flex items-center justify-center transition-colors"
              :class="tab === 'channels' ? 'border-white' : (enabledChannelCount > 0 ? 'border-emerald-500/50' : 'border-gray-600')">
              <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"
                x-show="enabledChannelCount > 0 && tab !== 'channels'"></div>
              <div class="w-1.5 h-1.5 rounded-full bg-white" x-show="tab === 'channels'"></div>
            </div>
            Channels
          </button>
        </div>
      </div>

      <!-- System Group -->
      <div>
        <h3 class="px-3 text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">System</h3>
        <div class="space-y-0.5">
          <button @click="tab = 'settings'"
            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
            :class="tab === 'settings' ? 'text-white' : 'text-gray-500 hover:text-gray-300'">
            <div
              class="w-4 h-4 rounded border-2 border-dashed border-gray-600 flex items-center justify-center transition-colors"
              :class="{'!border-white border-solid': tab === 'settings'}"></div>
            Settings
          </button>

          <button @click="tab = 'logs'"
            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
            :class="tab === 'logs' ? 'text-white' : 'text-gray-500 hover:text-gray-300'">
            <div
              class="w-4 h-4 rounded border-2 border-dashed border-gray-600 flex items-center justify-center transition-colors"
              :class="{'!border-white border-solid': tab === 'logs'}"></div>
            Logs
          </button>
        </div>
      </div>
    </nav>

    <!-- Footer Actions -->
    <div class="p-4 border-t border-gray-800 space-y-3 bg-black">
      <div class="grid grid-cols-2 gap-2">
        <button @click="startGateway()" :disabled="status.gateway?.state === 'running'"
          class="px-3 py-2 bg-gray-900 border border-gray-800 hover:border-gray-600 hover:bg-gray-800 text-xs font-medium rounded-lg text-gray-400 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed">
          Start
        </button>
        <button @click="stopGateway()" :disabled="status.gateway?.state === 'stopped'"
          class="px-3 py-2 bg-gray-900 border border-red-900/30 hover:border-red-800/50 hover:bg-gray-800 text-xs font-medium rounded-lg text-red-500 transition disabled:opacity-50 disabled:cursor-not-allowed">
          Stop
        </button>
      </div>
      <button @click="saveConfig()" :disabled="saving"
        class="w-full py-2.5 bg-white text-black hover:bg-gray-200 rounded-lg text-xs font-bold uppercase tracking-wide transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
        <span x-show="!saving">Save Changes</span>
        <span x-show="saving" class="animate-pulse">Saving...</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 overflow-y-auto bg-black p-10 h-full relative">

    <!-- Toast Notification -->
    <div x-show="toast.show" x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
      x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0"
      x-transition:leave-end="opacity-0 translate-y-2"
      class="fixed top-6 right-6 z-50 px-4 py-3 rounded-lg text-sm font-medium shadow-2xl border border-gray-800 flex items-center gap-3"
      :class="toast.type === 'error' ? 'bg-red-950/90 text-red-200 border-red-900' : 'bg-gray-900/90 text-white backdrop-blur'">
      <div class="w-2 h-2 rounded-full" :class="toast.type === 'error' ? 'bg-red-500' : 'bg-emerald-500'"></div>
      <span x-text="toast.message"></span>
    </div>

    <!-- OVERVIEW TAB -->
    <div x-show="tab === 'overview'" class="space-y-8 max-w-5xl">
      <div>
        <h2 class="text-3xl font-medium tracking-tight mb-2">Overview</h2>
        <p class="text-gray-500 text-sm">Welcome to Nanobot. Configure your agents and monitor system health from this
          centralized dashboard.</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- System Status -->
        <div
          class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 relative overflow-hidden group hover:border-gray-700 transition-colors">
          <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition-opacity">
            <div class="w-16 h-16 rounded-full bg-gradient-to-br from-emerald-500 to-transparent blur-xl"
              x-show="status.gateway?.state === 'running'"></div>
          </div>
          <h3 class="text-xs font-bold text-gray-600 uppercase tracking-widest mb-4">System Status</h3>
          <div class="flex items-center justify-between">
            <span class="text-2xl font-medium capitalize" x-text="status.gateway?.state || 'Unknown'"></span>
            <div class="w-2 h-2 rounded-full"
              :class="status.gateway?.state === 'running' ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.6)]' : 'bg-gray-600'">
            </div>
          </div>
        </div>

        <!-- Active Providers -->
        <div
          class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 hover:border-gray-700 transition-colors cursor-pointer"
          @click="tab = 'providers'">
          <h3 class="text-xs font-bold text-gray-600 uppercase tracking-widest mb-4">Active Providers</h3>
          <div class="flex items-center justify-between">
            <span class="text-3xl font-medium" x-text="activeProviderCount"></span>
            <span class="px-2 py-1 rounded bg-gray-800 text-[10px] text-gray-400 font-mono">API KEYS</span>
          </div>
        </div>

        <!-- Enabled Channels -->
        <div
          class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 hover:border-gray-700 transition-colors cursor-pointer"
          @click="tab = 'channels'">
          <h3 class="text-xs font-bold text-gray-600 uppercase tracking-widest mb-4">Enabled Channels</h3>
          <div class="flex items-center justify-between">
            <span class="text-3xl font-medium" x-text="enabledChannelCount"></span>
            <span class="text-xs text-gray-500">messaging platforms</span>
          </div>
        </div>
      </div>

      <!-- Setup Workflow Guide -->
      <div class="bg-gray-900/30 border border-gray-800 rounded-xl p-8">
        <h3 class="text-lg font-medium mb-6">Setup Workflow</h3>
        <div class="relative">
          <!-- Line -->
          <div class="absolute top-4 left-0 w-full h-0.5 bg-gray-800 -z-10"></div>

          <div class="flex justify-between items-start">
            <!-- Step 1 -->
            <div class="flex flex-col items-center gap-3 group cursor-pointer" @click="tab = 'providers'">
              <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center bg-black transition-colors"
                :class="activeProviderCount > 0 ? 'border-emerald-500 text-emerald-500' : 'border-gray-700 text-gray-500 group-hover:border-gray-500'">
                <span x-show="activeProviderCount == 0">1</span>
                <svg x-show="activeProviderCount > 0" class="w-4 h-4" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <div class="text-center">
                <p class="text-sm font-medium" :class="activeProviderCount > 0 ? 'text-white' : 'text-gray-400'">Add
                  Provider</p>
                <p class="text-xs text-gray-600 mt-1">Configure at least one AI model</p>
              </div>
            </div>

            <!-- Step 2 -->
            <div class="flex flex-col items-center gap-3 group cursor-pointer" @click="tab = 'channels'">
              <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center bg-black transition-colors"
                :class="enabledChannelCount > 0 ? 'border-emerald-500 text-emerald-500' : 'border-gray-700 text-gray-500 group-hover:border-gray-500'">
                <span x-show="enabledChannelCount == 0">2</span>
                <svg x-show="enabledChannelCount > 0" class="w-4 h-4" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <div class="text-center">
                <p class="text-sm font-medium" :class="enabledChannelCount > 0 ? 'text-white' : 'text-gray-400'">Add
                  Channel</p>
                <p class="text-xs text-gray-600 mt-1">Connect a messaging platform</p>
              </div>
            </div>

            <!-- Step 3 -->
            <div class="flex flex-col items-center gap-3">
              <div
                class="w-8 h-8 rounded-full border-2 border-gray-700 flex items-center justify-center bg-black text-gray-500">
                <span>3</span>
              </div>
              <div class="text-center">
                <p class="text-sm font-medium text-gray-400">Save & Start</p>
                <p class="text-xs text-gray-600 mt-1">Apply changes and launch gateway</p>
              </div>
            </div>

            <!-- Step 4 -->
            <div class="flex flex-col items-center gap-3">
              <div
                class="w-8 h-8 rounded-full border-2 border-gray-700 flex items-center justify-center bg-black text-gray-500">
                <span>4</span>
              </div>
              <div class="text-center">
                <p class="text-sm font-medium text-gray-400">Verify</p>
                <p class="text-xs text-gray-600 mt-1">Ping the bot to test</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI PROVIDERS TAB -->
    <div x-show="tab === 'providers'" class="space-y-6 max-w-5xl">
      <div class="mb-8">
        <h2 class="text-2xl font-medium mb-1">AI Providers</h2>
        <p class="text-gray-500 text-sm">Manage API keys and endpoints for LLM services.</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <template x-for="p in providerList" :key="p.key">
          <div
            class="bg-gray-900/50 border border-gray-800 rounded-xl p-5 hover:border-gray-700 transition-all duration-200 group relative">
            <!-- Provider Status Dot -->
            <div class="absolute top-5 right-5 w-2 h-2 rounded-full"
              :class="getProvider(p.key, 'apiKey') ? 'bg-emerald-500' : 'bg-gray-700'"></div>

            <div class="flex items-center gap-3 mb-4">
              <div
                class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs font-bold text-gray-400 uppercase"
                x-text="p.label[0]"></div>
              <h3 class="font-medium text-gray-200" x-text="p.label"></h3>
            </div>

            <div class="space-y-4">
              <div>
                <input type="password"
                  class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 placeholder-gray-600 focus:outline-none focus:border-gray-600 focus:ring-1 focus:ring-gray-600 transition-colors"
                  :value="getProvider(p.key, 'apiKey')" @input="setProvider(p.key, 'apiKey', $event.target.value)"
                  placeholder="API Key">
              </div>
              <div x-show="p.hasBase">
                <input type="text"
                  class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 placeholder-gray-600 focus:outline-none focus:border-gray-600 focus:ring-1 focus:ring-gray-600 transition-colors"
                  :value="getProvider(p.key, 'apiBase')" @input="setProvider(p.key, 'apiBase', $event.target.value)"
                  :placeholder="p.basePlaceholder || 'Base URI (Optional)'">
              </div>
            </div>
          </div>
        </template>
      </div>

      <div class="flex justify-end pt-4">
        <button @click="tab = 'channels'"
          class="flex items-center gap-2 px-5 py-2.5 bg-white text-black hover:bg-gray-200 rounded-lg text-sm font-medium transition-colors">
          <span>Next: Configure Channels</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- CHANNELS TAB -->
    <div x-show="tab === 'channels'" class="space-y-6 max-w-5xl">
      <div class="mb-8">
        <h2 class="text-2xl font-medium mb-1">Channels</h2>
        <p class="text-gray-500 text-sm">Connect to messaging platforms.</p>
      </div>

      <div class="space-y-4">
        <!-- Telegram -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-0 overflow-hidden transition-all duration-200"
          :class="{'bg-gray-900 border-gray-700': config.channels.telegram.enabled}">
          <div class="p-5 flex items-center justify-between cursor-pointer"
            @click="config.channels.telegram.enabled = !config.channels.telegram.enabled">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-400">
                <!-- Simple Icon Placeholder -->
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" />
                </svg>
              </div>
              <div>
                <h3 class="font-medium text-white">Telegram</h3>
                <p class="text-xs text-gray-500">BotFather Token</p>
              </div>
            </div>

            <!-- Toggle Switch -->
            <div
              class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out"
              :class="config.channels.telegram.enabled ? 'bg-white' : 'bg-gray-800'">
              <span class="inline-block h-4 w-4 transform rounded-full bg-black transition duration-200 ease-in-out"
                :class="config.channels.telegram.enabled ? 'translate-x-6' : 'translate-x-1'"></span>
            </div>
          </div>

          <div x-show="config.channels.telegram.enabled" x-collapse>
            <div class="p-5 pt-0 border-t border-gray-800 mt-2 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="mt-4">
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Token</label>
                <input type="password"
                  class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                  x-model="config.channels.telegram.token" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
              </div>
              <div class="mt-4">
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Allowed User
                  IDs</label>
                <input type="text"
                  class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                  :value="(config.channels.telegram.allowFrom || []).join(', ')"
                  @input="config.channels.telegram.allowFrom = $event.target.value.split(',').map(s => s.trim()).filter(Boolean)"
                  placeholder="Comma separated IDs">
              </div>
            </div>
          </div>
        </div>

        <!-- WhatsApp -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-0 overflow-hidden"
          :class="{'bg-gray-900 border-gray-700': config.channels.whatsapp.enabled}">
          <div class="p-5 flex items-center justify-between cursor-pointer"
            @click="config.channels.whatsapp.enabled = !config.channels.whatsapp.enabled">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-400">
                <span class="font-bold text-xs">WA</span>
              </div>
              <div>
                <h3 class="font-medium text-white">Whatsapp</h3>
                <p class="text-xs text-gray-500">Local Bridge</p>
              </div>
            </div>
            <div
              class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out"
              :class="config.channels.whatsapp.enabled ? 'bg-white' : 'bg-gray-800'">
              <span class="inline-block h-4 w-4 transform rounded-full bg-black transition duration-200 ease-in-out"
                :class="config.channels.whatsapp.enabled ? 'translate-x-6' : 'translate-x-1'"></span>
            </div>
          </div>
          <div x-show="config.channels.whatsapp.enabled" x-collapse>
            <div class="p-5 pt-0 border-t border-gray-800 mt-2 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="mt-4">
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Bridge
                  URL</label>
                <input type="text"
                  class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                  x-model="config.channels.whatsapp.bridgeUrl">
              </div>
              <div class="mt-4">
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Allowed
                  Numbers</label>
                <input type="text"
                  class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                  :value="(config.channels.whatsapp.allowFrom || []).join(', ')"
                  @input="config.channels.whatsapp.allowFrom = $event.target.value.split(',').map(s => s.trim()).filter(Boolean)">
              </div>
            </div>
          </div>
        </div>

        <!-- Discord (Placeholder style for other channels to match screenshot) -->
        <div
          class="bg-gray-900/50 border border-gray-800 rounded-xl p-5 flex items-center justify-between opacity-50 cursor-not-allowed">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-500">
              <span class="font-bold text-xs">DS</span>
            </div>
            <div>
              <h3 class="font-medium text-gray-400">Discord</h3>
              <p class="text-xs text-gray-600">Bot Token</p>
            </div>
          </div>
          <!-- Disabled Toggle -->
          <div class="h-6 w-11 rounded-full bg-gray-800 relative"><span
              class="absolute left-1 top-1 h-4 w-4 rounded-full bg-gray-600"></span></div>
        </div>

        <!-- Slack -->
        <div
          class="bg-gray-900/50 border border-gray-800 rounded-xl p-5 flex items-center justify-between opacity-50 cursor-not-allowed">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-500">
              <span class="font-bold text-xs">SL</span>
            </div>
            <div>
              <h3 class="font-medium text-gray-400">Slack</h3>
              <p class="text-xs text-gray-600">App Token</p>
            </div>
          </div>
          <div class="h-6 w-11 rounded-full bg-gray-800 relative"><span
              class="absolute left-1 top-1 h-4 w-4 rounded-full bg-gray-600"></span></div>
        </div>

        <!-- Feishu -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-0 overflow-hidden"
          :class="{'bg-gray-900 border-gray-700': config.channels.feishu.enabled}">
          <div class="p-5 flex items-center justify-between cursor-pointer"
            @click="config.channels.feishu.enabled = !config.channels.feishu.enabled">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-400">
                <span class="font-bold text-xs">FS</span>
              </div>
              <div>
                <h3 class="font-medium text-white">Feishu</h3>
                <p class="text-xs text-gray-500">Lark/Feishu App</p>
              </div>
            </div>
            <div
              class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out"
              :class="config.channels.feishu.enabled ? 'bg-white' : 'bg-gray-800'">
              <span class="inline-block h-4 w-4 transform rounded-full bg-black transition duration-200 ease-in-out"
                :class="config.channels.feishu.enabled ? 'translate-x-6' : 'translate-x-1'"></span>
            </div>
          </div>
          <div x-show="config.channels.feishu.enabled" x-collapse>
            <div class="p-5 pt-0 border-t border-gray-800 mt-2 space-y-4">
              <div class="mt-4 grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">App ID</label>
                  <input type="text"
                    class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                    x-model="config.channels.feishu.appId">
                </div>
                <div>
                  <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">App
                    Secret</label>
                  <input type="password"
                    class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                    x-model="config.channels.feishu.appSecret">
                </div>
              </div>
              <!-- ... other feishu fields ... -->
            </div>
          </div>
        </div>

        <!-- Dingtalk (Placeholder) -->
        <div
          class="bg-gray-900/50 border border-gray-800 rounded-xl p-5 flex items-center justify-between opacity-50 cursor-not-allowed">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-500">
              <span class="font-bold text-xs">DT</span>
            </div>
            <div>
              <h3 class="font-medium text-gray-400">Dingtalk</h3>
              <p class="text-xs text-gray-600">DingTalk Robot</p>
            </div>
          </div>
          <div class="h-6 w-11 rounded-full bg-gray-800 relative"><span
              class="absolute left-1 top-1 h-4 w-4 rounded-full bg-gray-600"></span></div>
        </div>
      </div>
    </div>

    <!-- SETTINGS TAB -->
    <div x-show="tab === 'settings'" class="space-y-6 max-w-5xl">
      <div class="mb-8">
        <h2 class="text-2xl font-medium mb-1">Settings</h2>
        <p class="text-gray-500 text-sm">System configuration and defaults.</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Agent Behaviour -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
          <h3 class="text-sm font-bold text-white mb-6">Agent Behaviour</h3>
          <div class="space-y-5">
            <div>
              <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Default
                Model</label>
              <input type="text"
                class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                x-model="config.agents.defaults.model">
            </div>
            <div>
              <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Max Tokens</label>
              <input type="number"
                class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                x-model.number="config.agents.defaults.maxTokens">
            </div>
            <div>
              <label
                class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Temperature</label>
              <input type="number" step="0.1"
                class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                x-model.number="config.agents.defaults.temperature">
            </div>
          </div>
        </div>

        <!-- Tools & Environment -->
        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
          <h3 class="text-sm font-bold text-white mb-6">Tools & Environment</h3>
          <div class="space-y-5">
            <div>
              <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Brave Search API
                Key</label>
              <input type="password"
                class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                x-model="config.tools.web.search.apiKey">
            </div>
            <div>
              <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Execution Timeout
                (s)</label>
              <input type="number"
                class="w-full bg-black border border-gray-800 rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:border-gray-600 focus:outline-none"
                x-model.number="config.tools.exec.timeout">
            </div>
            <div class="pt-2">
              <label class="flex items-center gap-3 cursor-pointer">
                <div
                  class="relative inline-flex h-5 w-9 items-center rounded-full transition-colors duration-200 ease-in-out"
                  :class="config.tools.exec.restrictToWorkspace ? 'bg-white' : 'bg-gray-800'">
                  <span class="inline-block h-3 w-3 transform rounded-full bg-black transition duration-200 ease-in-out"
                    :class="config.tools.exec.restrictToWorkspace ? 'translate-x-5' : 'translate-x-1'"></span>
                </div>
                <span class="text-xs text-gray-400">Restrict File Access</span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- LOGS TAB -->
    <div x-show="tab === 'logs'" class="h-full flex flex-col">
      <div class="mb-6 flex items-center justify-between">
        <h2 class="text-2xl font-medium">System Logs</h2>
        <button @click="logs = []" class="text-xs text-blue-400 hover:text-blue-300 font-medium">Refresh /
          Clear</button>
      </div>

      <div
        class="flex-1 bg-[#0d1117] border border-gray-800 rounded-lg p-4 font-mono text-xs overflow-y-auto log-viewer"
        x-ref="logViewer">
        <template x-for="(line, i) in logs" :key="i">
          <div class="mb-1 break-all">
            <!-- Simple highlighting based on keywords -->
            <span x-html="formatLogLine(line)"></span>
          </div>
        </template>
        <div x-show="logs.length === 0" class="text-gray-600 italic">No logs available...</div>
      </div>
    </div>

  </main>

  <script>
    function app() {
      return {
        tab: 'overview',
        config: defaultConfig(),
        status: {},
        logs: [],
        saving: false,
        restartAfterSave: true,
        toast: { show: false, message: '', type: 'success' },

        providerList: [
          { key: 'anthropic', label: 'Anthropic', hasBase: false },
          { key: 'openai', label: 'OpenAI', hasBase: true, basePlaceholder: 'https://api.openai.com/v1' },
          { key: 'openrouter', label: 'OpenRouter', hasBase: true, basePlaceholder: 'https://openrouter.ai/api/v1' },
          { key: 'deepseek', label: 'DeepSeek', hasBase: false },
          { key: 'groq', label: 'Groq', hasBase: false },
          { key: 'gemini', label: 'Gemini', hasBase: false },
          { key: 'zhipu', label: 'Zhipu', hasBase: true },
          { key: 'vllm', label: 'vLLM', hasBase: true, basePlaceholder: 'http://localhost:8000/v1' },
        ],

        get activeProviderCount() {
          if (!this.status.providers) return 0;
          return Object.values(this.status.providers).filter(p => p.configured).length;
        },

        get enabledChannelCount() {
          if (!this.status.channels) return 0;
          return Object.values(this.status.channels).filter(c => c.enabled).length;
        },

        getProvider(key, field) {
          return this.config.providers?.[key]?.[field] || '';
        },
        setProvider(key, field, value) {
          if (!this.config.providers[key]) this.config.providers[key] = {};
          this.config.providers[key][field] = value;
        },

        async init() {
          await this.loadConfig();
          await this.loadStatus();
          await this.loadLogs();
          setInterval(() => this.loadStatus(), 5000);
          setInterval(() => this.loadLogs(), 3000);
        },

        async loadConfig() {
          try {
            const res = await fetch('/api/config');
            if (res.ok) {
              const data = await res.json();
              this.config = mergeDeep(defaultConfig(), data);
            }
          } catch (e) { }
        },

        async saveConfig() {
          this.saving = true;
          try {
            const payload = JSON.parse(JSON.stringify(this.config));
            payload._restartGateway = this.restartAfterSave;
            const res = await fetch('/api/config', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
            });
            if (res.ok) {
              this.showToast('Configuration saved successfully', 'success');
              await this.loadConfig();
            } else {
              this.showToast('Failed to save configuration', 'error');
            }
          } catch (e) {
            this.showToast('Save error: ' + e.message, 'error');
          }
          this.saving = false;
        },

        async loadStatus() {
          try {
            const res = await fetch('/api/status');
            if (res.ok) this.status = await res.json();
          } catch (e) { }
        },

        async loadLogs() {
          try {
            const res = await fetch('/api/logs');
            if (res.ok) {
              const data = await res.json();
              const wasAtBottom = this.$refs.logViewer &&
                (this.$refs.logViewer.scrollTop + this.$refs.logViewer.clientHeight >= this.$refs.logViewer.scrollHeight - 50);
              this.logs = data.lines;
              if (wasAtBottom && this.$refs.logViewer) {
                this.$nextTick(() => {
                  this.$refs.logViewer.scrollTop = this.$refs.logViewer.scrollHeight;
                });
              }
            }
          } catch (e) { }
        },

        async startGateway() {
          await fetch('/api/gateway/start', { method: 'POST' });
          this.showToast('Starting gateway...', 'success');
          setTimeout(() => this.loadStatus(), 1000);
        },

        async stopGateway() {
          await fetch('/api/gateway/stop', { method: 'POST' });
          this.showToast('Stopping gateway...', 'success');
          setTimeout(() => this.loadStatus(), 1000);
        },

        formatLogLine(line) {
          if (line.includes('ERROR')) return `<span class="text-red-400">üî• ${line}</span>`;
          if (line.includes('WARN')) return `<span class="text-yellow-400">‚ö†Ô∏è ${line}</span>`;
          if (line.includes('INFO')) return `<span class="text-gray-400">‚ÑπÔ∏è ${line}</span>`;
          return `<span class="text-gray-500">${line}</span>`;
        },

        showToast(message, type = 'success') {
          this.toast = { show: true, message, type };
          setTimeout(() => { this.toast.show = false; }, 3000);
        }
      };
    }

    function defaultConfig() {
      return {
        agents: { defaults: { workspace: '~/.nanobot/workspace', model: 'anthropic/claude-opus-4-5', maxTokens: 8192, temperature: 0.7, maxToolIterations: 20 } },
        channels: {
          telegram: { enabled: false, token: '', allowFrom: [], proxy: null },
          whatsapp: { enabled: false, bridgeUrl: 'ws://localhost:3001', allowFrom: [] },
          feishu: { enabled: false, appId: '', appSecret: '', encryptKey: '', verificationToken: '', allowFrom: [] },
        },
        providers: {
          anthropic: { apiKey: '', apiBase: null },
          openai: { apiKey: '', apiBase: null },
          openrouter: { apiKey: '', apiBase: null },
          deepseek: { apiKey: '', apiBase: null },
          groq: { apiKey: '', apiBase: null },
          gemini: { apiKey: '', apiBase: null },
        },
        gateway: { host: '0.0.0.0', port: 18790 },
        tools: { web: { search: { apiKey: '', maxResults: 5 } }, exec: { timeout: 60, restrictToWorkspace: false } },
      };
    }

    function mergeDeep(target, source) {
      const output = { ...target };
      for (const key of Object.keys(source)) {
        if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
          output[key] = mergeDeep(target[key] || {}, source[key]);
        } else {
          output[key] = source[key];
        }
      }
      return output;
    }
  </script>
</body>

</html>